# Readme. Простой движок для блога

> Цели этого файла помочь студенту максимально качественно подготовится к защите, чтобы не пропустить ни один пунки ТЗ.
> Ведь не выполнение хотя бы одного пунта нарушает быловый кретерий защиты Б1
> 
> - ⏳ студент еще не приступал к заданию
> - ☑ задание выполнено студентом, но еще не было проверено наставником
> - ✅ задание проверено наставником и удовлетворяет условию ТЗ
> - ❌ задание проверено наставником и оно **НЕ** удовлетворяет условию ТЗ
> 
> #### Workflow
>  - Студент берёт пункт ТЗ со значком ⏳ или ❌
>  - После его выполнения, студент ставит ☑
>  
>  После проверки наставником, оно переходит в статус ✅ - если все хорошо или ❌ - если требует доработок

### О проекте
«Readme» — это простой headless-движок для блога, построенный с помощью микросервисной архитектуры и современного фреймворка Nest.js. Проект состоит из нескольких микросервисов, каждый сервис решает одну задачу.

### Общая концепция проекта
Вам предстоит разработать бэкенд для многопользовательского блога. Главная особенность сервиса — формат публикаций (их несколько) и возможность оформить подписку на обновления других пользователей. Подписка на пользователей влияет на контентную ленту пользователя.

### Технические требования
Для разработки проекта применяется микросервисная архитектура. Студент самостоятельно определяет список микросервисов для приложения. Общее требование к сервисам: каждый сервис решает свою задачу.

Некоторые сервисы могут содержать свою базу данных. Решение по выбору базы данных и её необходимость для определённого микросервиса остаётся на усмотрение студента. В приложении могут использоваться следующие СУБД: MongoDB, PostgreSQL.

Для лучшего понимания работы проекта, студенту предоставляется полный набор вёрстки. Создавать из неё готовый фронтенд НЕ нужно. В рамках курса мы разрабатываем только бэкенд.

В корневой директории проекта размещается файл specification.md. Файл содержит все необходимые инструкции для запуска проекта.

Для разработки проекта используется актуальный LTS-релиз платформы Node.js. При необходимости студент может устанавливать дополнительные пакеты.

Код сервисов разрабатывается только на TypeScript. Все сервисы размещаются в монорепозитории. Для построения монорепозитория используется NX.

Техническое задание не определяет контракты и конкретные ресурсы разрабатываемого приложения. Решение по разделению приложения на сервисы, проектирование ресурсов API и другие архитектурные решения студент принимает самостоятельно.

### Общий список сценариев
 - 1.1. ⏳ Регистрация новых пользователей.
 - 1.2. ⏳ Авторизация пользователей на основе JWT.
 - 1.3. ⏳ Создание новых публикаций в блоге разных видов: видео, текст, цитата, фото, ссылка.
 - 1.4. ⏳ Просмотр детальной информации о публикации.
 - 1.5. ⏳ Редактирование публикаций в блоге.
 - 1.6. ⏳ Удаление публикаций в блоге.
 - 1.7. ⏳ Загрузка изображений для публикации в блоге.
 - 1.8. ⏳ Комментирование публикаций в блоге.
 - 1.9. ⏳ Лайки к публикациям. Подсчёт количества лайков к публикациям.
 - 1.10. ⏳ Пагинация для публикаций.
 - 1.11. ⏳ Получение списка публикаций.
 - 1.12. ⏳ Получение списка публикаций с применением сортировки: по популярности, дате создания, по количеству лайков, по количеству комментариев.
 - 1.13. ⏳ Репост публикаций.
 - 1.14. ⏳ Лента пользователя.
 - 1.15. ⏳ Категоризация публикаций по тегам.
 - 1.16. ⏳ Рассылка почтовых уведомлений на email о появлении новых публикаций.
 - 1.17. ⏳ Поиск публикаций по названию.
 - 1.18. ⏳ Получение детальной информации о пользователе.
 - 1.19. ⏳ Смена пароля пользователя.
 - 1.20. ⏳ Подписка на обновления других пользователей.

### Функциональность
1. Регистрация и авторизация пользователей
   - 1.1. ⏳ Регистрация доступна только анонимным клиентам.
   - 1.2. ☑ Для регистрации клиент передаёт следующий набор информации:
     - ☑ Электронная почта (обязательно). Используется в качестве логина. Адрес уникален: в базе данных не может быть двух пользователей с одинаковым email.
     - ☑ Имя пользователя (обязательно). Фамилия и имя пользователя. Минимальная длина поля: 3 символа, максимальная 50 символов.
     - ☑ Пароль (обязательно). Пароль пользователя. Минимальная длина пароля 6 символов, максимальная 12.
     - ☑ Аватар пользователя (опционально). Фотография для аватарки пользователя. Ограничения: не больше 500 килобайт, формат jpeg или png.
   - 1.3. ⏳ Перед записью информации в базу данных, выполняется процесс валидации. В случае обнаружения ошибок, полный список отправляется клиенту.
   - 1.4. ⏳ Загруженные изображения для аватара могут хранится как в файловой системе, так и в базе данных.
   - 1.5. ☑ Приложение фиксирует дату регистрации пользователя. Дата регистрации пользователя используется для внутренних нужд.
   - 1.6. ☑ Пароль пользователя не хранится в базе данных в открытом виде. Вместо пароля в базе хранится его хеш. Для выполнения хеширования применяется пакет bcrypt.
   - 1.7. ☑ В случае успешной регистрации пользователя, приложение возвращает корректный код состояния и объект с информацией о созданном пользователе. Все необходимые контракты определяются студентом самостоятельно.
   - 1.8. ⏳ Авторизация пользователей построена на основе JWT. После успешной проверки логина и пароля, приложение возвращает JWT токен. Токен содержит playground со всей необходимой информацией.
   - 1.9.☑  Авторизованный пользователь может сменить свой пароль. Для изменения пароля пользователь передаёт следующий набор информации:
      - ☑ Текущий пароль (обязательно).
      - ☑ Новый пароль (обязательно). Минимальная длина 6 символов, максимальная 12. Перед изменением пароля проверяется, что переданный пользователем текущий пароль соответствует тому, что сохранён в базе.
   - 1.10. ⏳ Пользователь может запросить детальную информацию по определенному пользователю. Информация запрашивает по идентификатору пользователя. Возвращаемая информация включает:
      - ⏳ Дата регистрации пользователя;
      - ⏳ Количество публикаций пользователя;
      - ⏳ Количество подписчиков;
      - ⏳ Уникальный идентификатор пользователя.
2. Публикация постов в блоге
   - 2.1. ⏳ Создавать, редактировать, удалять публикации могут только авторизованные пользователи.
   - 2.2. ⏳ Пользователи могут редактировать и удалять только свои публикации. Удаление и редактирование публикаций происходит на основании уникального идентификатора публикации.
   - 2.3. ⏳ Удаление публикации приводит к автоматическому удалению оставленных к ней комментариев.
   - 2.4. ⏳ Публикации в блоге могут быть одного из пяти видов: видео, текст, цитата, фото, ссылка. От вида публикации зависит какой набор информации передаёт клиент.
   - 2.5. ⏳ Для создания новой публикации типа «Видео» клиент передаёт следующий набор информации:
      - ⏳ Название публикации (обязательно). Минимальная длина 20 символов, максимальная 50.
      - ⏳ Ссылка на видео (обязательно). Валидная ссылка на страницу с видео на сервисе YouTube. Способ проверки валидности ссылки остаётся на усмотрение студента.
      - ⏳ Набор тегов (опционально). Список тегов к публикации. Ограничения и требования к тегам приведены в разделе «Теги к публикациям».
   - 2.6. ⏳ Для создания новой публикации типа «Текст» клиент передаёт следующий набор информации:
      - ⏳ Название публикации (обязательно). Минимальная длина 20 символов, максимальная 50.
      - ⏳ Анонс публикации (обязательно). Текст с анонсом публикации. Минимальная длина 50 символов, максимальная 255.
      - ⏳ Текст публикации (обязательно). Минимальная длина 100 символов, максимальная 1024 символа.
      - ⏳ Набор тегов (опционально). Список тегов к публикации. Ограничения и требования к тегам приведены в разделе «Теги к публикациям».
   - 2.7. ⏳ Для создания новой публикации типа «Цитата» клиент передаёт следующий набор информации:
      - ⏳ Текст цитаты (обязательно). Минимальная длина 20 символов, максимальная 300.
      - ⏳ Автор цитаты (обязательно). Минимальная длина 3 символа, максимальная 50.
      - ⏳ Набор тегов (опционально). Список тегов к публикации. Ограничения и требования к тегам приведены в разделе «Теги к публикациям».
   - 2.8. ⏳ Для создания новой публикации типа «Фото» клиент передаёт следующий набор информации:
      - ⏳ Фотография (обязательно). Максимальный размер фотографии: 1 мегабайт. Допускаются форматы: jpg, png.
      - ⏳ Набор тегов (опционально). Список тегов к публикации. Ограничения и требования к тегам приведены в разделе «Теги к публикациям».
   - 2.9. ⏳ Для создания новой публикации типа «Ссылка» клиент передаёт следующий набор информации:
      - ⏳ Ссылка (обязательно). Валидный URL.
      - ⏳ Описание (опционально). Описание ссылки. Максимальный размер 300 символов.
      - ⏳ Набор тегов (опционально). Список тегов к публикации. Ограничения и требования к тегам приведены в разделе «Теги к публикациям».
   - 2.10. ⏳ Автор публикации определяется автоматически во время сохранения в базу данных.
   - 2.11. ⏳ Для каждой публикации автоматически сохраняется дата создания публикации и дата публикации. При первом сохранении публикации они равны. «Дата публикации» пользователь может отредактировать в будущем. Она влияет на сортировку публикаций.
   - 2.12. ⏳ Публикация может находиться в одном из двух состояний: «Опубликована» и «Черновик». Состояние после создания: «Опубликована».
   - 2.13. ⏳ Авторизованные пользователи могут репостить публикации других пользователей. Под репостом публикации подразумевается копирование публикации в список своих публикаций. Репост одной публикации можно сделать один раз. После копирования:
     - ⏳ Меняется автор публикации. При этом информация об оригинальном авторе сохраняется дополнительно.
     - ⏳ Обновляется дата и время публикации. Устанавливается текущая дата.
     - ⏳ Для публикации фиксируется признак «Репост».
     - ⏳ Дополнительно сохраняется уникальный идентификатор оригинальной публикации.
   - 2.14. ⏳ Пользователь может запросить у приложения детальную информацию о публикации. Запрос детальной информации о публикации происходит по уникальному идентификатору. Детальная информация включает всю информацию о публикации, включая служебные флаги такие как «признак репоста».
3. Список публикаций
   - 3.1. ⏳ Пользователи могут запрашивать список публикаций. Эта возможность доступна анонимным и авторизованным пользователям. Приложение возвращает список из последних 25 публикаций. В список публикаций попадают публикации разных пользователей.
   - 3.2. ⏳ Пользователь может запросить следующие 25 или оставшиеся публикации (если их меньше 25). Для этого он передаёт дополнительные данные в запрос.
   - 3.3. ⏳ Пользователь может запросить публикации определённого пользователя. В этом случае приложение возвращает только публикации определённого пользователя.
   - 3.4. ⏳ При получении публикаций определённого пользователя действуют те же правила и ограничения (количество, пагинация) перечисленные в пунктах 3.1, 3.2.
   - 3.5. ⏳ В список публикаций попадают только публикации в статусе «Опубликовано».
   - 3.6. ⏳ По умолчанию приложение возвращает список публикаций, отсортированных по дате публикации (по убыванию). Пользователь может передать дополнительные параметры в запрос и изменить вариант сортировки. Доступные варианты сортировки:
     - ⏳ Дата публикации (по убыванию). Вариант сортировки по умолчанию;
     - ⏳ Лайки (по убыванию). Публикации сортируются по количеству лайков. Сначала публикации с наибольшим количеством лайков.
     - ⏳ Обсуждаемые (по убыванию). Публикации сортируются по количеству комментариев. Сначала публикации с наибольшим количеством комментариев.
   - 3.7. ⏳ Каждая публикация в списке помимо информации о самой публикации содержит: тип публикации, количество лайков, количество комментариев, дата публикации, информация об авторе (имя, фамилия, идентификатор, email).
   - 3.8. ⏳ Пользователь может запросить публикации определённого типа. Для этого он передаёт дополнительную информацию в запрос.
   - 3.9. ⏳ Авторизованный пользователь может получить список своих черновиков (публикации в состоянии «Черновик»).
   - 3.10. ⏳ Если отдельный сервис не содержит определённой части информации, то он возвращает только идентификаторы. Недостающая информация может быть добавлена в BFF.
   - 3.11. ⏳ Пользователь может запросить список публикаций по определённому тегу.
4. Моя лента
   - 4.1. ⏳ Авторизованные пользователи могут подписываться на других пользователей.
   - 4.2. ⏳ Подписка на пользователей позволяет сформировать контентную ленту пользователя. Она строится на основе публикаций пользователей, на которых оформлена подписка.
   - 4.3. ⏳ В контентную ленту также входят публикации, созданные автором.
   - 4.4. ⏳ Для контентной ленты справедливы правила сортировки, пагинации, количества, которые перечислены в пункте «Список публикаций».
   - 4.5. ⏳ Для подписки на пользователя используется уникальный идентификатор пользователя.
   - 4.6. ⏳ Приложение предоставляет возможность отписаться от ранее оформленной подписки. При отмене подписки, из контентной ленты пользователя пропадают материалы автора, на которого была оформлена подписка.
5. Лайки
   - 5.1. ⏳ Лайки к публикациям могут оставлять только авторизованные пользователи.
   - 5.2. ⏳ Пользователи могут оставлять лайки для публикаций, которые находятся в состоянии «Опубликована».
   - 5.3. ⏳ Пользователь может оставить только один лайк для конкретной публикации. Также пользователь может сделать обратную операцию: «забрать», ранее оставленный к публикации лайк.
6. Комментарии
   - 6.1. ⏳ Комментировать публикации могут только авторизованные пользователи.
   - 6.2. ⏳ Для создания нового комментария пользователь передаёт следующую информацию:
     - ⏳ Текст комментария (обязательно). Минимальная длина: 10 символов, максимальная: 300.
     - ⏳ Идентификатор публикации (обязательно). Публикация, для которой создаётся комментарий.
   - 6.3. ⏳ Информацию об авторе комментария, дату создания комментария приложение определяет автоматически.
   - 6.4. ⏳ Пользователь может удалить свой комментарий. Удаление комментариев других пользователей запрещено. Удаление комментариев производится по уникальному идентификатору комментария.
   - 6.5. ⏳ Для любой опубликованной публикации пользователь (в том числе и анонимный) может запросить список комментариев. По умолчанию приложение возвращает список из 50 комментариев.
   - 6.6. ⏳ Пользователь может запросить следующие 50 комментариев (или оставшиеся, если их меньше). Для этого он передаёт дополнительную информацию в запрос.
7. Уведомления на email
   - 7.1. ⏳ Приложение умеет рассылать уведомления о новых публикациях на email.
   - 7.2. ⏳ Уведомления рассылаются всем зарегистрированным пользователям.
   - 7.3. ⏳ Письмо с информацией об обновлениях содержит список новых публикаций с момента последней рассылки.
   - 7.4. ⏳ Оформление письма остаётся на усмотрение студента.
   - 7.5. ⏳ Запуск рассылки уведомлений осуществляется по запросу пользователя.
8. Поиск
   - 8.1. ⏳ Приложение предоставляет функцию поиска публикаций. Ей могут воспользоваться как авторизованные, так и анонимные пользователи.
   - 8.2. ⏳ Поиск публикации происходит по заголовку публикации. Достаточно совпадения отдельных слов. В поиске участвуют все опубликованные публикации, у которых есть заголовки (название публикации).
   - 8.3. ⏳ Результатом поиска может быть несколько публикаций. Поиск не возвращает больше 20 публикаций.
9. Backend For Frontend
   - 9.1. ⏳ Backend for Frontend (BFF) — это отдельный сервис, который взаимодействует с другими сервисами приложения и готовит данные для фронтенда.
   - 9.2. ⏳ Для реализации некоторых сценариев требуется взаимодействовать с несколькими сервисами. Например, если за сервис пользователей отвечает отдельный микросервис, а за публикации отвечает другой микросервис, то на уровне BFF может быть реализована логика соединения ответов от сервисов с целью форматирования данных, чтобы ими было удобней пользоваться на стороне фронтенда.
   
### Теги к публикациям
  - ⏳ Теги для публикаций опциональны.
  - ⏳ Любой тег состоит из одного слова и не может содержать пробелы.
  - ⏳ Максимальное количество тегов к публикации: 8 штук.
  - ⏳ Все теги хранятся в нижнем регистре. Пользователь может отправлять теги в любом регистре, при сохранении теги приводятся нижнему регистру.
  - ⏳ Теги не повторяются. Клиент может отправить несколько одинаковых тегов для публикации. Это не должно приводить к ошибкам. Дубли автоматически удаляются.
  - ⏳ Тег должен начинаться с буквы. Минимальная длина тега: 3 символа. Максимальная: 10.
  - ⏳ Передача для публикации больше 8 тегов приводит к ошибке валидации.

### Документирование
⏳ Сервисы, предоставляющие REST API содержат документацию в формате OpenAPI. Документирование выполняется с помощью встроенных средств в фреймворк Nest.

### Безопасность
☑ В коде приложения не должно быть зашито конфиденциальной информации: пароли, секреты и так далее.
Для передачи секретов, паролей и другой конфиденциальной информации используются переменные окружения.
Если требуется написать SQL-запрос, который принимает параметры, то используются параметризованные запросы.

### Необязательные задания
В этом разделе перечислены дополнительные задания. Невыполнение этих заданий не влияет на защиту проекта по базовым критериям.
Необязательные сценарии:
- Backend For Fronted;
- Моя лента.
